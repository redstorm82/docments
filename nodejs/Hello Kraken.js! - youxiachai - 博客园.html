<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="utf-8"/>
<title>Hello Kraken.js! - youxiachai - 博客园</title>
<link type="text/css" rel="stylesheet" href="/bundles/blog-common.css?v=VDh8zSH1vx51MDqRT7hK220akQ58FjlaaeGuWBPhfOA1"/>
<link id="MainCss" type="text/css" rel="stylesheet" href="/skins/Minyx2_Lite/bundle-Minyx2_Lite.css?v=box8Dmmj5G0VFMZyypCbLIqNJsuu5lz6TpJ4OOK0WkE1"/>
<link type="text/css" rel="stylesheet" href="/blog/customcss/92891.css?v=ojgPFHVghNulz%2fCstVtphfp2uDw%3d"/>
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/youxilua/rss"/>
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/youxilua/rsd.xml"/>
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/youxilua/wlwmanifest.xml"/>
<script src="http://common.cnblogs.com/script/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'youxilua', cb_enable_mathjax=false;</script>
<script src="/bundles/blog-common.js?v=JoVOWMb-iZn6s7f1mHI0Z_8uEB-CbY41K0NgN6_Ttzc1" type="text/javascript"></script>
<script src="/skins/Minyx2_Lite/bundle-Minyx2_Lite.js?v=dAK2Rw4GyogXqBvhMZEW0IkYD2kjtuL3y_BKRj-vp4g1" language="javascript" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>


<div id="container">
    <a class="minyx" href="http://www.cnblogs.com/">代码改变世界</a>
    <ul id="topMnu">
        <!-- 统计数据 -->
        <li>
            
                
Posts - 95, 
Articles - 0, 
Comments - 581
<!---->
            
        </li>
        <!-- 这边可以增加一些链接 -->
        <!-- 博客园 -->
        <li><a href="http://www.cnblogs.com">Cnblogs</a></li>
        <!-- 管理 -->
        <li id="topMnu-dashboard">
            <a id="lnkDashboard" href="http://www.cnblogs.com/youxilua/admin/EditPosts.aspx">Dashboard</a></li>
        <li>
            <a id="lnkLogin" href="http://passport.cnblogs.com/login.aspx?ReturnUrl=http://www.cnblogs.com/youxilua/p/3452341.html">Login</a></li>
    </ul>

    <script type="text/javascript">
        var m = window.__blog.topMenuRendered;
        if (m) { m(__$("topMnu")); }
    </script>

    <div id="header">
        <ul id="menu">
            <!-- 首页，当前section加上current类 -->
            <li id="menu-home" class="current">
                <a id="lnkHome" href="http://www.cnblogs.com/youxilua/">Home</a></li>
            <!-- 联系 -->
            <li id="menu-contact">
                <a id="lnkContact" href="http://space.cnblogs.com/msg/send/youxiachai">Contact</a></li>
            <!-- 相册 -->
            <li id="menu-gallary">
                <a id="lnkGallery" href="http://www.cnblogs.com/youxilua/gallery.html">Gallery</a></li>
            <!-- Rss订阅 -->
            <li id="rss">
                <a id="lnkRss" href="http://www.cnblogs.com/youxilua/rss">RSS</a></li>
        </ul>
        <div id="newmsg"></div>
        <h1>
            <!-- 主标题 -->
            <a id="lnkBlogTitle" href="http://www.cnblogs.com/youxilua/">youxiachai</a>
            <!-- 子标题 -->
            <small>
                lua?python?R?java?c/c++?javaScript?php?</small>
        </h1>
    </div>

    <script type="text/javascript">
        var m = window.__blog.headerRendered;
        if (m) { m(__$("header")); }
    </script>

    <div id="wrapper">
        <div id="content">
            <script type="text/javascript">
                var m = window.__blog.preRenderPosts;
                if (m) { m(); }
            </script>
            
<div id="post_detail">
<div class="post" id="post">
    <a name="top"></a>
    <h2><a id="cb_post_title_url" href="http://www.cnblogs.com/youxilua/p/3452341.html">Hello Kraken.js!</a></h2>
    <small>2013-12-01 11:14 by youxiachai, <span id="post_view_count">...</span> 阅读, <span id="post_comment_count">...</span> 评论, <a href="#" onclick="AddToWz(3452341);return false;">收藏</a>,  <a href ="http://i.cnblogs.com/EditPosts.aspx?postid=3452341" rel="nofollow">编辑</a></small>
    <div class="entry">
        <div id="cnblogs_post_body"><p>&#160;</p>  <h2>前言</h2>  <p>kraken.js 由paypal 公司开源的一个用于快速开发基于Express.js框架应用的快速开发工具, 因为kraken 并没有在Express.js基础上更改多少东西,只是在原来的express基础上补充了一些约定开发的规则, 让开发根据便捷.</p>  <h2>你好,世界!</h2>  <p>要创建一个kraken 项目只需要非常简单的三步走:</p>  <ol>   <li>     <p>安装必备工具</p>      <blockquote>       <p>Linux or Mac          <br /><code>sudo npm install -g generator-kraken</code>           <br />Windows           <br /><code>npm install -g generator-kraken</code></p>     </blockquote>   </li>    <li>     <p>创建kraken项目        <br />只需要一行代码,然后,看着提示语,输入一些东西,一个项目就这样创建完毕.</p>      <blockquote>       <p><code>yo kraken</code></p>     </blockquote>   </li>    <li>     <p>运行kraken项目        <br />还是只需要一行代码</p>      <blockquote>       <p><code>npm start</code></p>     </blockquote>   </li> </ol>  <p>以上三行代码即可,完成一个kraken项目的创建了.</p>  <h3>注意事项:</h3>  <ol>   <li>     <p><code>yo kraken</code> 你输入项目名字的时候,会在当前项目创建与该项目名字一样的文件夹,记得<code>cd</code> 进去文件夹再去运行 <code>npm start</code></p>   </li>    <li>     <p>注意<code>NODE_ENV</code>的设置,kraken的配置是会根据当前<code>NODE_ENV</code>进行变化,所以如果跑不通的时候最好检查一下当前的<code>NODE_ENV</code>.默认情况下,<code>NODE_ENV</code>没有设置或者设置了<code>development</code>,启动的时候,<code>kraken</code> 会默认加载<code>./public/templates</code> 下的模板,设置了其他值的时候,就会去加载<code>./.build/templates</code> 而这个当你在<code>kraken</code> 项目目录下运行<code>grunt build</code> 就会出现<code>.build</code> 该目录了用于部署在<code>NODE_ENV</code>设置为<code>production</code>或者其他值的时候加载.</p>   </li> </ol>  <p>查看你当前系统的<code>NODE_ENV</code>环境</p>  <blockquote>   <p>Linux or Mac</p>    <blockquote>     <p><code>echo $NODE_ENV</code></p>   </blockquote>    <p>Windows</p>    <blockquote>     <p><code>echo %NODE_ENV%</code></p>   </blockquote> </blockquote>  <h2>约定开发</h2>  <p>个人看法 <code>kraken</code> 与其说是一个框架好不如说它只不过提供了灵活,方便的用于构建Express应用的方式.</p>  <h3>配置(/config)</h3>  <p><code>kraken</code> 在 <code>./config</code> 约定了两类配置文件:</p>  <ol>   <li><code>app.json</code> 用于配置,host, port, i18n ,express 等. </li>    <li><code>middleware</code> 用于对默认中间件的配置,目前支持的中间件有<code>appsec</code>, <code>compiler</code>, <code>session</code>, <code>errorPages</code>, <code>static</code>, 详细的参数配置请阅读官方文档,这里就不赘述了. </li> </ol>  <p>除此以外,<code>kraken</code> 还约定支持根据<code>NODE_ENV</code>自动匹配相应的配置文件,规则是:</p>  <blockquote>   <p><code>app-NODE_ENV.json</code></p> </blockquote>  <p>例如, 当前<code>NODE_ENV</code>是<code>development</code>, 你在目录下有一个<code>app-development.json</code>的文件话,就会优先读取该文件的配置.</p>  <h3>控制器(/controllers)</h3>  <h3>路由控制</h3>  <p><code>kraken</code> 默认会自动加载<code>./controllers</code> 下的文件,进行路由控制,个人觉得,这个真心省心.接下来的写法,与express 完全一样!</p>  <pre><code class="js" data-origin="&lt;pre&gt;&lt;code class=&quot;js&quot;&gt;module.exports = function (server) {&#13;&#10;    server.get(&#39;/customer&#39;, function (req, res) {&#13;&#10;       res.send(&#39;Hello World&#39;);&#13;&#10;    });&#13;&#10;};&#13;&#10;&lt;/code&gt;&lt;/pre&gt;">module.exports = <span class="function"><span class="keyword">function</span> <span class="params">(server)</span> {</span>
    server.get(<span class="string">'/customer'</span>, <span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> {</span>
       res.send(<span class="string">'Hello World'</span>);
    });
};
</code></pre>

<p>如果,你是express的开发者,就会越感发现,<code>kraken</code>更多的是补充了express不足的地方,除此以外跟平常用express开发毫无区别.</p>

<h3>自定义中间件 和 周期控制</h3>

<p><code>kraken</code> 将一个请求的周期定义为三级:</p>

<ol>
  <li><code>app.requestStar</code> 请求开始 </li>

  <li><code>app.requestBeforeRoute</code> 进行路由前 </li>

  <li><code>app.requestAfterRoute</code> 路由后输出 </li>
</ol>

<p>整个实现异常简洁, 有兴趣的可以去阅读源码:</p>

<blockquote>
  <p><code>appcore.js</code> <code>line: 172 - 198</code></p>
</blockquote>

<p>定义一个中间件的方法与express的时候一样,只不过,现在多了一步,我们要把中间件放到哪个位置而已</p>

<p>约定在<code>./middleware/lib</code> 下建一个文件,beforeRouteMiddleware.js</p>

<pre><code class="js" data-origin="&lt;pre&gt;&lt;code class=&quot;js&quot;&gt;module.exports = function () {_&#13;&#10;    var reqCounts = 0;&#13;&#10;    return function (req, res, next) {&#13;&#10;        req.counts = reqCounts | 0;&#13;&#10;        reqCounts++;&#13;&#10;        next();&#13;&#10;    };&#13;&#10;};&#13;&#10;&lt;/code&gt;&lt;/pre&gt;">module.exports = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>_
    <span class="keyword">var</span> reqCounts = <span class="number">0</span>;
    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(req, res, next)</span> {</span>
        req.counts = reqCounts | <span class="number">0</span>;
        reqCounts++;
        next();
    };
};
</code></pre>

<p>然后在: index.js</p>

<pre><code class="js" data-origin="&lt;pre&gt;&lt;code class=&quot;js&quot;&gt;var beforeRouteMiddleware =  require(&#39;./lib/middleware/beforeRouteMiddleware&#39;)&#13;&#10;&#13;&#10;app.requestBeforeRoute = function requestBeforeRoute(server) {&#13;&#10;    server.use(beforeRouteMiddleware());&#13;&#10;};&#13;&#10;&lt;/code&gt;&lt;/pre&gt;"><span class="keyword">var</span> beforeRouteMiddleware =  require(<span class="string">'./lib/middleware/beforeRouteMiddleware'</span>)

app.requestBeforeRoute = <span class="function"><span class="keyword">function</span> <span class="title">requestBeforeRoute</span><span class="params">(server)</span> {</span>
    server.use(beforeRouteMiddleware());
};
</code></pre>

<p>与express的中间件功能一样,每请求一次,都会触发中间件. 与原生的express不同<code>krarken</code>提供了更有条例的中间件定义约定.</p>

<h2>总结</h2>

<p><code>kraken</code> 还有一些比较实用的功能,例如安全,还有本地化,不过这些内容,官方文档已经写得很详细了,这里就不作过多的说明. 在我看来,<code>kraken</code> 只干了一件事,就是把express条理化了,<code>kraken</code>并没有对express进行更多的封装,所以,只要会express的入手<code>kraken</code> 就像喝水一样简单. 而<code>kraken</code> 提供的约定,能够更有效率的开发Node.js的web项目.</p></div><div id="MySignature"></div>
        <div class="clear"></div>
        <div id="blog_post_info_block">
        <div id="blog_post_info">
        </div>
        <div class="clear"></div>
        <div id="post_next_prev"></div>
    </div>
</div>
    <ul class="postmetadata">
        <li class="icon_cat" id="BlogPostCategory"></li>
        <li class="icon_bullet" id="EntryTag"></li>
    </ul>
</div>
<script type="text/javascript">var allowComments=true,isLogined=false,cb_blogId=92891,cb_entryId=3452341,cb_blogApp=currentBlogApp,cb_blogUserGuid='ea4f4814-6df0-df11-ac81-842b2b196315',cb_entryCreatedDate='2013/12/1 11:14:00';loadViewCount(cb_entryId);</script>
<script type="text/javascript">
    var m = window.__blog.postRendered;
    if (m) { m(__$("post")); }
</script>
<script type="text/javascript">
    var m = window.__blog.postRenderPosts;
    if (m) { m(); }
</script>
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" id="lnk_RefreshComments" onclick="return RefreshCommentList();">刷新评论</a><a href="#" onclick="return RefreshPage();">刷新页面</a><a href="#top">返回顶部</a></div>
<div id="comment_form_container"></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="site_nav_under"><a href="http://www.cnblogs.com/" target="_blank" title="开发者的网上家园">博客园首页</a><a href="http://q.cnblogs.com/" target="_blank" title="程序员问答社区">博问</a><a href="http://news.cnblogs.com/" target="_blank" title="IT新闻">新闻</a><a href="http://home.cnblogs.com/ing/" target="_blank">闪存</a><a href="http://job.cnblogs.com/" target="_blank">程序员招聘</a><a href="http://kb.cnblogs.com/" target="_blank">知识库</a></div>
<div id="opt_under_post"></div>
<script type="text/javascript">
    var enableGoogleAd = canShowAdsense(); 
    fixPostBodyFormat();
</script>
<script type='text/javascript'>
  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
    (function () {
        if (enableGoogleAd) {
            var gads = document.createElement('script');
            gads.async = true;
            gads.type = 'text/javascript';
            var useSSL = 'https:' == document.location.protocol;
            gads.src = (useSSL ? 'https:' : 'http:') +
              '//www.googletagservices.com/tag/js/gpt.js';
            var node = document.getElementsByTagName('script')[0];
            node.parentNode.insertBefore(gads, node);
        }
  })();
</script>
<script type='text/javascript'>
    try {
        if (enableGoogleAd) {
            googletag.cmd.push(function() {
            googletag.defineSlot('/1090369/cnblogs_blogpost_C2', [468, 60], 'div-gpt-ad-1433581717989-0').addService(googletag.pubads());
            googletag.defineSlot('/1090369/cnblogs_blogpost_C1_sitehome', [300, 250], 'div-gpt-ad-1433581717989-1').addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.pubads().collapseEmptyDivs();
            googletag.enableServices();
            });
        };
    } catch (e) { }
</script>
<div id="google_ad_c1" class="c_ad_block">
    <div id='div-gpt-ad-1433581717989-1' style='height:250px; width:300px;'>
    <script type='text/javascript'>
        try {
            if (enableGoogleAd) {
                googletag.cmd.push(function () { googletag.display('div-gpt-ad-1433581717989-1'); });
            } else {
                $('#div-gpt-ad-1433581717989-1').hide();
            }
    } catch (e) { }
    </script>
    </div>
</div>
<div id="under_post_news"></div>
<div id="google_ad_c2" class="c_ad_block">
<div id='div-gpt-ad-1433581717989-0' style='height:60px; width:468px;'>
<script type='text/javascript'>
try {
    if (enableGoogleAd) {
        googletag.cmd.push(function () { googletag.display('div-gpt-ad-1433581717989-0'); });
    } else {
        $('#div-gpt-ad-1433581717989-0').hide();
    }
} catch (e) { }
</script>
</div>
</div>
<div id="under_post_kb"></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
$(function () {
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
    setTimeout(function () { incrementViewCount(cb_entryId); }, 200);
});
</script>
</div>

        </div>

        <script type="text/javascript">
            var m = window.__blog.contentRendered;
            if (m) { m(__$("content")); }
        </script>

        <div id="sidebar">
            
<div id="about">
<div>
<h2 id="about_title">About</h2>
<div id="about_body">
<div id="blog-news"></div>
<script type="text/javascript">loadBlogNews();</script>
</div>
</div>
</div>

            <script type="text/javascript">
                var m = window.__blog.aboutRendered;
                if (m) { m(__$("about")); }
            </script>
            
<div id="mySearchWrapper">
    <div id="mySearch">
        <input type="image" src="/skins/Minyx2_Lite/images/btnsearch.gif" id="btnZzk"  class="submit" onclick="zzk_go();return false;"/>
        <label class="lb_search"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="keyword" /></label>
    </div>
</div>

            <script type="text/javascript">
                var m = window.__blog.searchFormRendered;
                if (m) { m(__$("searchform")); }
            </script>
            <div id="sideMain">
            </div>
            <div id="sideRight">
            </div>
            <div id="sideLeft">
            </div>
            
                <div id="sideContainer">
                </div>
                <script type="text/javascript">
                    $.ajax({
                        url: '/' + currentBlogApp + '/mvc/blog/Minyx2_Lite_SideColumn.aspx',
                        data: '{}',
                        type: 'post',
                        dataType: 'text',
                        contentType: 'application/json; charset=utf-8',
                        success: function (data) {
                            if (data) {
                                $("#sideContainer").html(data);
                                loadBlogDefaultCalendar();
                                loadBlogSideBlocks();
                                var m = window.__blog.sideContainerRendered;
                                if (m) { m(__$("sideContainer")); }
                                window.__blog.sidebar.__layout();
                            }
                        }
                    });

                </script>
            
        </div>

        <script type="text/javascript">
            var m = window.__blog.sidebarRendered;
            if (m) { m(__$("sidebar")); }
        </script>

        <div id="footer">
            
<p id="logoFoot">
    <a href="http://www.spiga.com.mx/" title="Agencia Interactiva Spiga">www.spiga.com.mx</a>
</p>
<div class="footText">
<p>
Copyright &copy;2015 youxiachai
</p>
<p>
<a href="http://www.cnblogs.com">博客园</a>
</p>
</div>
        </div>
    </div>

    <script type="text/javascript">
        var m = window.__blog.wrapperRendered;
        if (m) { m(__$("wrapper")); }
    </script>

</div>
<script type="text/javascript">
    var m = window.__blog.containerRendered;
    if (m) { m(__$("container")); }
</script>
<!--PageEndHtml Block Begin-->
<!-- JiaThis Button BEGIN -->
<script type="text/javascript">var jiathis_config = {data_track_clickback:true};</script>
<script type="text/javascript" src="http://v2.jiathis.com/code/jiathis_r.js?move=0&amp;uid=1567310" charset="utf-8"></script>
<!-- JiaThis Button END -->

<!--PageEndHtml Block End-->
</body>
</html>
