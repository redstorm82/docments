<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <!-- meta -->
  <meta charset="utf-8"/>
  <meta name='description' content='CNodeï¼šNode.jsä¸“ä¸šä¸­æ–‡ç¤¾åŒº'>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="keywords" content="nodejs, node, express, connect, socket.io"/>
  <meta name="apple-itunes-app" content="app-id=954734793">
  <!-- see http://smerity.com/articles/2013/where_did_all_the_http_referrers_go.html -->
  <meta name="referrer" content="always">

  
  <meta name="author" content="EDP@TaoBao" />
  
  <meta property="wb:webmaster" content="617be6bd946c6b96" />
  

  <link title="RSS" type="application/rss+xml" rel="alternate" href="/rss"/>

  
  <link rel="icon" href="//dn-cnodestatic.qbox.me/public/images/cnode_icon_32.png" type="image/x-icon"/>
  

  <!-- style -->
  <link rel="stylesheet" href="//dn-cnodestatic.qbox.me/public/stylesheets/index.min.36689462.min.css" media="all" />


  <!-- scripts -->
  <script src="//dn-cnodestatic.qbox.me/public/index.min.4dde195f.min.js"></script>


  
  <title>Nodejså¼€æºé¡¹ç›®é‡Œæ€ä¹ˆæ ·å†™æµ‹è¯•ã€CIå’Œä»£ç æµ‹è¯•è¦†ç›–ç‡ - CNode</title>
  
  <meta content="_csrf" name="csrf-param">
  <meta content="9j8fxdFU-fgNaEN0QtXOAYShct3i3fesbTjo" name="csrf-token">
</head>
<body>
<!-- navbar -->
<div class='navbar'>
  <div class='navbar-inner'>
    <div class='container'>
      <a class='brand' href='/'>
        
          <img src="//dn-cnodestatic.qbox.me/public/images/cnodejs_light.svg" />
        
      </a>

      <form id='search_form' class='navbar-search' action="/search">
        <input type='text' id='q' name='q' class='search-query span3' value=''/>
      </form>
      <ul class='nav pull-right'>
        <li><a href='/'>é¦–é¡µ</a></li>
        
        <li><a href='/getstart'>æ–°æ‰‹å…¥é—¨</a></li>
        <li><a href='/api'>API</a></li>
        
        <li><a href="/about" target="">å…³äº</a></li>
        
        
        <li><a href='/signup'>æ³¨å†Œ</a></li>
        <li><a href='/signin'>ç™»å½•</a></li>
        
      </ul>
      <a class="btn btn-navbar" id="responsive-sidebar-trigger">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
    </div>
  </div>
</div>
<div id='main'>
  <div id='sidebar'>
  <div class='panel'>
    <div class='header'>
      <span class='col_fade'>ä½œè€…</span>
    </div>
    <div class='inner'>
      <div class='user_card'>
  <div>
    <a class='user_avatar' href="/user/i5ting">
      <img src="/agent?url=https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F3118295%3Fv%3D3%26s%3D120" title="i5ting"/>
    </a>
    <span class='user_name'><a class='dark' href="/user/i5ting">i5ting</a></span>

    <div class='board clearfix'>
      <div class='floor'>
        <span class='big'>ç§¯åˆ†: 5385 </span>
      </div>
    </div>
    <div class="space clearfix"></div>
    <span class="signature">
        â€œ
        
            å°‘æŠ±æ€¨ï¼Œå¤šæ€è€ƒï¼Œæœªæ¥æ›´ç¾å¥½
        
        â€
    </span>
  </div>
</div>



    </div>
  </div>

  
    
<div class='panel'>
  <div class='inner ads'>

    
      
      <a href="https://bearychat.com/" target="_blank" class="banner sponsor_outlink"
    data-label="bearychat">
        <img src="//dn-cnode.qbox.me/Foy27SgPGvfuZ3w9rSGik4crv8oW">
      </a>
    
      
        <div class="sep10"></div>
      
      <a href="http://www.apicloud.com/" target="_blank" class="banner sponsor_outlink"
    data-label="apicloud">
        <img src="//dn-cnode.qbox.me/FsmD61Bf12f7l4zTXp6hoJ-6D4Ao">
      </a>
    
      
        <div class="sep10"></div>
      
      <a href="https://cnodejs.org/topic/559e927f3d79442724b9f1e2" target="_blank" class="banner sponsor_outlink"
    data-label="shimo">
        <img src="//dn-cnode.qbox.me/FsIC6DBRkw1sfVF5V0G-Qc5UOYZP">
      </a>
    
      
        <div class="sep10"></div>
      
      <a href="http://www.oneapm.com/ai/feature.html?utm_source=cnode&utm_medium=billboard&utm_term=master&utm_campaign=JulyTechAds&from=maadfiseno" target="_blank" class="banner sponsor_outlink"
    data-label="oneapm">
        <img src="//dn-cnode.qbox.me/FiHabJNEMPYpbpxZJd4maf8EY1fF">
      </a>
    
      
        <div class="sep10"></div>
      
      <a href="https://www.jpush.cn/" target="_blank" class="banner sponsor_outlink"
    data-label="jpush">
        <img src="//dn-cnode.qbox.me/FjckLnF0VNcXA3yiD_11Hd5xBxIR">
      </a>
    
      
        <div class="sep10"></div>
      
      <a href="https://tower.im/?s=cnodejs" target="_blank" class="banner sponsor_outlink"
    data-label="tower">
        <img src="//dn-cnode.qbox.me/FptAiXgArDRK-0Rd5UdPqA8zJlWy">
      </a>
    
      
        <div class="sep10"></div>
      
      <a href="http://www.rongcloud.cn/" target="_blank" class="banner sponsor_outlink"
    data-label="rongcloud">
        <img src="//dn-cnode.qbox.me/FmMTa1PNYP3gig6q1yoYz1QncUYL">
      </a>
    
      
        <div class="sep10"></div>
      
      <a href="http://100offer.com/join/cnode71?utm_source=cnode71&utm_medium=dis&utm_campaign=cnode71" target="_blank" class="banner sponsor_outlink"
    data-label="100offer">
        <img src="//dn-cnode.qbox.me/FojExpHUPJ_1iG7qDOJvnRQ7RmnX">
      </a>
    
      
        <div class="sep10"></div>
      
      <a href="https://www.wilddog.com/" target="_blank" class="banner sponsor_outlink"
    data-label="wilddog">
        <img src="//dn-cnode.qbox.me/FgF7oZaTe70WOGoM-FB9r_f4kRPH">
      </a>
    
      
        <div class="sep10"></div>
      
      <a href="http://videojj.com/" target="_blank" class="banner sponsor_outlink"
    data-label="videojj">
        <img src="//dn-cnode.qbox.me/FuBkApd_djji3AtnUm4i4A0aAO6S">
      </a>
    
      
        <div class="sep10"></div>
      
      <a href="http://www.jiankongbao.com/" target="_blank" class="banner sponsor_outlink"
    data-label="jiankongbao">
        <img src="//dn-cnode.qbox.me/FgqoCO3YpU7B5jdG_7GPhVnXc1eG">
      </a>
    
      
        <div class="sep10"></div>
      
      <a href="https://talk.ai/?s=cnodejs" target="_blank" class="banner sponsor_outlink"
    data-label="teambition">
        <img src="//dn-cnode.qbox.me/FsJ2QW9zAHLvrPgC767PvuMWBkRQ">
      </a>
    
  </div>
</div>

  

  <div class='panel'>
    <div class='header'>
      <span class='col_fade'>ä½œè€…å…¶å®ƒè¯é¢˜</span>
    </div>
    <div class='inner'>
      
      <ul class='unstyled'>
        <li>
  <div><a class='dark topic_title' href="/topic/55a25700419f1e8a23a64372" title="ã€æ·±jsã€‘pptåˆ†äº«">ã€æ·±jsã€‘pptåˆ†äº«</a>
  </div>
</li>
<li>
  <div><a class='dark topic_title' href="/topic/5590adbbebf9c92d17e734de" title="mongodbè¿ç»´ä¹‹å‰¯æœ¬é›†å®è·µ">mongodbè¿ç»´ä¹‹å‰¯æœ¬é›†å®è·µ</a>
  </div>
</li>
<li>
  <div><a class='dark topic_title' href="/topic/559c69e51e5c7617614688db" title="gulpç»“æ„åŒ–">gulpç»“æ„åŒ–</a>
  </div>
</li>
<li>
  <div><a class='dark topic_title' href="/topic/559ba9221e5c761761468859" title="ä»npm tipsåˆ°expressæ’ä»¶æœºåˆ¶è®¾è®¡">ä»npm tipsåˆ°expressæ’ä»¶æœºåˆ¶è®¾è®¡</a>
  </div>
</li>
<li>
  <div><a class='dark topic_title' href="/topic/559c797e1e5c7617614688f2" title="cçš„æµ‹è¯•åº“">cçš„æµ‹è¯•åº“</a>
  </div>
</li>

      </ul>
      
    </div>
  </div>

  <div class='panel'>
    <div class='header'>
      <span class='col_fade'>æ— äººå›å¤çš„è¯é¢˜</span>
    </div>
    <div class='inner'>
      
      <ul class='unstyled'>
        <li>
  <div><a class='dark topic_title' href="/topic/55bd9629f36f579657fc55c3" title="å¦‚ä½•åšåˆ° findByIdAndUpdate ä»…æ›´æ–°ä¸ä¸ºç©ºçš„å­—æ®µ?">å¦‚ä½•åšåˆ° findByIdAndUpdate ä»…æ›´æ–°ä¸ä¸ºç©ºçš„å­—æ®µ?</a>
  </div>
</li>
<li>
  <div><a class='dark topic_title' href="/topic/55bc6b02f36f579657fc5544" title="MongoDBè¿æ¥é—®é¢˜ï¼Ÿ">MongoDBè¿æ¥é—®é¢˜ï¼Ÿ</a>
  </div>
</li>
<li>
  <div><a class='dark topic_title' href="/topic/55baed56f36f579657fc543a" title="åœ¨WindowsæœåŠ¡å™¨ä¸Šå¼€å¯SNMPä»£ç†ç¨‹åº">åœ¨WindowsæœåŠ¡å™¨ä¸Šå¼€å¯SNMPä»£ç†ç¨‹åº</a>
  </div>
</li>
<li>
  <div><a class='dark topic_title' href="/topic/55badfedf36f579657fc53f9" title="mongodb ç®€å•æµ‹è¯•,åŒä¸€ä¸ªç´¢å¼•å­—æ®µä¸åŒå€¼æŸ¥è¯¢,ç»“æœé›†è¶Šå¤§,ååç‡è¶Šä½.">mongodb ç®€å•æµ‹è¯•,åŒä¸€ä¸ªç´¢å¼•å­—æ®µä¸åŒå€¼æŸ¥è¯¢,ç»“æœé›†è¶Šå¤§,ååç‡è¶Šä½.</a>
  </div>
</li>
<li>
  <div><a class='dark topic_title' href="/topic/55b9e214f36f579657fc52e9" title="node å¼€å‘ä½¿ç”¨ccapç”ŸæˆéªŒè¯ç è¿”å›buffer ä¹±ç ">node å¼€å‘ä½¿ç”¨ccapç”ŸæˆéªŒè¯ç è¿”å›buffer ä¹±ç </a>
  </div>
</li>

      </ul>
      
    </div>
  </div>
</div>

<div id='content'>
  <div class='panel'>
    <div class='header topic_header'>
      <span class="topic_full_title">

        


        Nodejså¼€æºé¡¹ç›®é‡Œæ€ä¹ˆæ ·å†™æµ‹è¯•ã€CIå’Œä»£ç æµ‹è¯•è¦†ç›–ç‡
      </span>
      <div class="action">
      
      </div>
      <div class="changes">
        <span>
          å‘å¸ƒäº 1ä¸ªæœˆå‰
        </span>
        <span>
          ä½œè€… <a href="/user/i5ting">i5ting</a>
        </span>
        <span>
          325 æ¬¡æµè§ˆ
        </span>
        
        
          <span> æ¥è‡ª åˆ†äº«</span>
        
      </div>
      
    </div>
    <div class='inner topic'>

      <div class='topic_content'>
        <div class="markdown-text"><p>wx æ˜¯ä¸€ä¸ªä¸é”™çš„å¾®ä¿¡åº”ç”¨æ¡†æ¶ï¼Œæ¥å£å’Œç½‘ç«™åšçš„ä¹Ÿä¸é”™ï¼Œå’Œwechat-apiæ˜¯ç±»ä¼¼çš„é¡¹ç›®</p>
<p>ç¾¤é‡Œæœ‰äººé—®å“ªä¸ªå¥½</p>
<p>æœ´çµè¯´ï¼šâ€œä¸å†™æµ‹è¯•çš„é¡¹ç›®éƒ½ä¸æ˜¯å¥½é¡¹ç›®â€</p>
<p>ç¡®å®wxç›®å‰è¿˜æ²¡æœ‰æµ‹è¯•ï¼Œå¯¹äºä¸€ä¸ªå¼€æºé¡¹ç›®æ¥è¯´ï¼Œæ²¡æœ‰æµ‹è¯•å’Œä»£ç è¦†ç›–ç‡æ˜¯ä¸å®Œå–„çš„ï¼Œè€Œä¸”ä»æŠ€æœ¯é€‰å‹æ¥è¯´ï¼Œå¤§å¤šæ˜¯ä¸æ•¢é€‰çš„ã€‚</p>
<p>é‚£ä¹ˆNodejså¼€æºé¡¹ç›®é‡Œæ€ä¹ˆæ ·å†™æµ‹è¯•ã€CIå’Œä»£ç æµ‹è¯•è¦†ç›–ç‡å‘¢ï¼Ÿ</p>
<h2>æµ‹è¯•</h2>
<p>ç›®å‰ä¸»æµçš„å°±bddå’Œtddï¼Œè‡ªå·±æŸ¥ä¸€ä¸‹å·®å¼‚</p>
<p>æ¨è</p>
<ul>
<li>mochaå’Œtape</li>
</ul>
<p>å¦å¤–Jasmineä¹ŸæŒºæœ‰åï¼Œangularjsç”¨å®ƒï¼Œä¸è¿‡æŒºéº»çƒ¦çš„ï¼Œè¿˜æœ‰ä¸€ä¸ªé€‰æ‹©æ˜¯qunitï¼Œæœ€åˆæ˜¯ä¸ºjqueryæµ‹è¯•å†™çš„ï¼Œåœ¨nodejsé‡Œç”¨è¿˜æ˜¯è§‰å¾—æ€ªæ€ªçš„ã€‚</p>
<p>å¦‚æœæƒ³ç®€å•å¯ä»¥tapï¼Œå®ƒå’Œtapeå¾ˆåƒï¼Œä¸‹æ–‡ä¼šæœ‰è¯¦ç»†è¯´æ˜</p>
<h3>mocha</h3>
<p>mochaæ˜¯tjå†™çš„</p>
<p><a href="https://github.com/mochajs/mocha">https://github.com/mochajs/mocha</a></p>
<pre class="prettyprint"><code>var assert = require(&quot;assert&quot;)
describe(&#x27;truth&#x27;, function(){
  it(&#x27;should find the truth&#x27;, function(){
    assert.equal(1, 1);
  })
})
</code></pre><p>æ–­è¨€é£æ ¼ï¼Œè¿™é‡Œé»˜è®¤æ˜¯assertï¼Œæ¨èä½¿ç”¨chaijsè¿™ä¸ªæ¨¡å—ï¼Œå®ƒæä¾›3ç§é£æ ¼</p>
<ul>
<li>Should</li>
<li>Expect</li>
<li>Assert</li>
</ul>
<p>rspecé‡Œæ¨èç”¨expectï¼Œå…¶å®çœ‹ä¸ªäººä¹ æƒ¯</p>
<p>æ¯”è¾ƒå…¸å‹ä¸€ä¸ªmochaä¾‹å­</p>
<pre class="prettyprint"><code>var assert = require(&#x27;chai&#x27;).assert;
var expect = require(&#x27;chai&#x27;).expect;
require(&#x27;chai&#x27;).should();


describe(&#x27;Test&#x27;, function(){
    before(function() {
    // runs before all tests in this block
    
  })
  after(function(){
    // runs after all tests in this block
  })
  beforeEach(function(){
    // runs before each test in this block
  })
  afterEach(function(){
    // runs after each test in this block
  })

  describe(&#x27;#test()&#x27;, function(){
    it(&#x27;should return ok when test finished&#x27;, function(done){
      assert.equal(&#x27;sang_test2&#x27;, &#x27;sang_test2&#x27;);
      var foo = &#x27;bar&#x27;;
      expect(foo).to.equal(&#x27;bar&#x27;);
      done()
    })
  })
})
</code></pre><p>è¯´æ˜</p>
<ul>
<li>ç†è§£æµ‹è¯•ç”Ÿå‘½å‘¨æœŸ</li>
<li>ç†è§£bddæµ‹è¯•å†™æ³•</li>
</ul>
<p>å•å…ƒæµ‹è¯•éœ€è¦çš„å„ä¸ªæ¨¡å—è¯´æ˜</p>
<ul>
<li>mochaï¼ˆMocha is a feature-rich JavaScript test framework running on node.js and the browser, making asynchronous testing simple and fun.ï¼‰</li>
<li>chaiï¼ˆChai is a BDD / TDD assertion library for node and the browser that can be delightfully paired with any javascript testing framework.ï¼‰</li>
<li>sinonï¼ˆStandalone test spies, stubs and mocks for JavaScript.ï¼‰</li>
<li>zombie (é¡µé¢äº‹ä»¶æ¨¡æ‹ŸZombie.js is a lightweight framework for testing client-side JavaScript code in a simulated environment. No browser required.)</li>
<li>supertest(æ¥å£æµ‹è¯• Super-agent driven library for testing node.js HTTP servers using a fluent API)</li>
</ul>
<p>æ›´å¤šçš„çœ‹ <a href="http://nodeonly.com/2014/11/24/mongoose-test.html">http://nodeonly.com/2014/11/24/mongoose-test.html</a></p>
<p>å¦‚æœä½ æƒ³çœŸæ­£çš„ç©æ•æ·ï¼Œä»ç”¨æˆ·æ•…äº‹å¼€å§‹ï¼Œé‚£ä¹ˆä¸‹é¢è¿™2ä¸ªåº“éå¸¸å¿…è¦</p>
<ul>
<li><a href="http://vowsjs.org/">http://vowsjs.org/</a></li>
<li><a href="https://github.com/cucumber/cucumber-js">https://github.com/cucumber/cucumber-js</a></li>
</ul>
<p>å•Šï¼Œé»„ç“œã€‚ã€‚ã€‚ã€‚</p>
<h3>tapeï¼šåƒä»£ç ä¸€æ ·è·‘æµ‹è¯•</h3>
<p>tapeæ˜¯substackå†™çš„æµ‹è¯•æ¡†æ¶</p>
<p><a href="https://github.com/substack/tape">https://github.com/substack/tape</a></p>
<pre class="prettyprint"><code>var test = require(&#x27;tape&#x27;).test;
test(&#x27;equivalence&#x27;, function(t) {
    t.equal(1, 1, &#x27;these two numbers are equal&#x27;);
    t.end();
});
</code></pre><p>tapeæ˜¯éå¸¸ç®€å•çš„æµ‹è¯•æ¡†æ¶ï¼Œæ ¸å¿ƒä»·å€¼è§‚æ˜¯â€Tests are codeâ€ï¼Œæ‰€ä»¥ä½ å¯ä»¥åƒä»£ç ä¸€æ ·è·‘æµ‹è¯•ï¼Œ</p>
<p>æ¯”å¦‚</p>
<pre class="prettyprint"><code>node test/test.js
</code></pre><p>å†™ä¸ªè„šæœ¬å°±æ— æ¯”ç®€å•äº†ã€‚å½“ç„¶å¦‚æœä½ æƒ³åŠ â€™test runnerâ€™ åº“ä¹Ÿæœ‰ç°æˆçš„ã€‚</p>
<h3>The Test Anything Protocol</h3>
<p>TAPå…¨ç§°æ˜¯<a href="https://en.wikipedia.org/wiki/Test_Anything_Protocol">Test Anything Protocol</a></p>
<p>å®ƒæ˜¯å¯é æ€§æµ‹è¯•çš„ä¸€ç§ï¼ˆtried &amp; trueï¼‰å®ç°</p>
<p>ä»1987å°±æœ‰äº†ï¼Œæœ‰å¾ˆå¤šè¯­è¨€éƒ½å®ç°äº†ã€‚</p>
<p>å®ƒè¯´ç™½ç‚¹å°±æ˜¯ç”¨è´¼ç®€å•çš„æ–¹å¼æ¥æ ¼å¼åŒ–æµ‹è¯•ç»“æœï¼Œæ¯”å¦‚</p>
<pre class="prettyprint"><code>TAP version 13
# equivalence
ok 1 these two numbers are equal

1..1
# tests 1
# pass  1

# ok
</code></pre><p>æ¯”å¦‚nodeé‡Œçš„å®ç°<a href="https://github.com/isaacs/node-tap">https://github.com/isaacs/node-tap</a></p>
<pre class="prettyprint"><code>var tap = require(&#x27;tap&#x27;)

// you can test stuff just using the top level object.
// no suites or subtests required.

tap.equal(1, 1, &#x27;check if numbers still work&#x27;)
tap.notEqual(1, 2, &#x27;1 should not equal 2&#x27;)

// also you can group things into sub-tests.
// Sub-tests will be run in sequential order always,
// so they&#x27;re great for async things.

tap.test(&#x27;first stuff&#x27;, function (t) {
  t.ok(true, &#x27;true is ok&#x27;)
  t.similar({a: [1,2,3]}, {a: [1,2,3]})
  // call t.end() when you&#x27;re done
  t.end()
})
</code></pre><p>ä¸€å®šè¦åŒºåˆ†tapå’Œtapeï¼Œä¸è¦å¼„æ··äº†</p>
<h2>ç§‘æ™®ä¸€ä¸‹ä»€ä¹ˆæ˜¯CI</h2>
<p>ç§‘æ™®ä¸€ä¸‹ï¼ŒCI = Continuous integration æŒç»­é›†æˆ</p>
<p>Martin Fowlerå¯¹æŒç»­é›†æˆæ˜¯è¿™æ ·å®šä¹‰çš„:</p>
<p>æŒç»­é›†æˆæ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å®è·µï¼Œå³å›¢é˜Ÿå¼€å‘æˆå‘˜ç»å¸¸é›†æˆä»–ä»¬çš„å·¥ä½œï¼Œé€šå¸¸æ¯ä¸ªæˆå‘˜æ¯å¤©è‡³å°‘é›†æˆä¸€æ¬¡ï¼Œä¹Ÿå°±æ„å‘³ç€æ¯å¤©å¯èƒ½ä¼šå‘ç”Ÿå¤šæ¬¡é›†æˆã€‚æ¯æ¬¡é›†æˆéƒ½é€šè¿‡è‡ªåŠ¨åŒ–çš„æ„å»ºï¼ˆåŒ…æ‹¬ç¼–è¯‘ï¼Œå‘å¸ƒï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•)æ¥éªŒè¯ï¼Œä»è€Œå°½å¿«åœ°å‘ç°é›†æˆé”™è¯¯ã€‚è®¸å¤šå›¢é˜Ÿå‘ç°è¿™ä¸ªè¿‡ç¨‹å¯ä»¥å¤§å¤§å‡å°‘é›†æˆçš„é—®é¢˜ï¼Œè®©å›¢é˜Ÿèƒ½å¤Ÿæ›´å¿«çš„å¼€å‘å†…èšçš„è½¯ä»¶ã€‚</p>
<p>å®ƒå¯ä»¥</p>
<ul>
<li>å‡å°‘é£é™©</li>
<li>å‡å°‘é‡å¤è¿‡ç¨‹</li>
<li>ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹ç”Ÿæˆå¯éƒ¨ç½²çš„è½¯ä»¶</li>
<li>å¢å¼ºé¡¹ç›®çš„å¯è§æ€§</li>
<li>å»ºç«‹å›¢é˜Ÿå¯¹å¼€å‘äº§å“çš„ä¿¡å¿ƒ</li>
</ul>
<p>è¦ç´ </p>
<p>1.ç»Ÿä¸€çš„ä»£ç åº“
2.è‡ªåŠ¨æ„å»º
3.è‡ªåŠ¨æµ‹è¯•
4.æ¯ä¸ªäººæ¯å¤©éƒ½è¦å‘ä»£ç åº“ä¸»å¹²æäº¤ä»£ç 
5.æ¯æ¬¡ä»£ç é€’äº¤åéƒ½ä¼šåœ¨æŒç»­é›†æˆæœåŠ¡å™¨ä¸Šè§¦å‘ä¸€æ¬¡æ„å»º
6.ä¿è¯å¿«é€Ÿæ„å»º
7.æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„è‡ªåŠ¨æµ‹è¯•
8.æ¯ä¸ªäººéƒ½å¯ä»¥å¾ˆå®¹æ˜“çš„è·å–æœ€æ–°å¯æ‰§è¡Œçš„åº”ç”¨ç¨‹åº
9.æ¯ä¸ªäººéƒ½æ¸…æ¥šæ­£åœ¨å‘ç”Ÿçš„çŠ¶å†µ
10.è‡ªåŠ¨åŒ–çš„éƒ¨ç½²</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæµ‹è¯•ä¸é€šè¿‡ä¸èƒ½éƒ¨ç½²ï¼Œåªæœ‰æäº¤åˆ°æœåŠ¡å™¨ä¸Šï¼Œå°±å¯ä»¥è‡ªåŠ¨è·‘æµ‹è¯•ï¼Œæµ‹è¯•é€šè¿‡åï¼Œå°±å¯ä»¥éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šäº†ï¼ˆæ³¨æ„æ˜¯&quot;staging&quot;, è€Œé&quot;production&quot;ï¼‰ã€‚</p>
<p>ä¸€èˆ¬æœ€å¸¸çš„ciè½¯ä»¶æ˜¯jenkins</p>
<p>ä¸¾ä¸ªå¤§å®¶ç†Ÿæ‚‰çš„ä¾‹å­iojså¼€å‘ä¸­çš„æŒç»­é›†æˆå°±æ˜¯ç”¨çš„jenkins</p>
<p><a href="https://jenkins-iojs.nodesource.com/">https://jenkins-iojs.nodesource.com/</a></p>
<p><img src="//dn-cnode.qbox.me/FhwCcCO-S3ux_wurD3oICDF3GwfH" alt="4.png"></p>
<p>jenkinsæ˜¯è‡ªå»ºç¯å¢ƒä¸‹ç”¨çš„æ¯”è¾ƒå¤šï¼Œå¦‚æœæ˜¯å¼€æºé¡¹ç›®ï¼Œæ¨ètravis-ci</p>
<p><a href="https://travis-ci.org/">https://travis-ci.org/</a></p>
<p>å¯¹å¼€æºé¡¹ç›®åšæŒç»­é›†æˆæ˜¯å…è´¹çš„ï¼ˆéå¼€æºçš„å¥½è´µï¼‰ï¼Œæ‰€ä»¥åœ¨githubé›†æˆçš„åŸºæœ¬æ˜¯æœ€å¤šçš„ã€‚</p>
<p>å¯¹nodejsæ”¯æŒçš„ä¹Ÿéå¸¸å¥½ã€‚</p>
<p>ä¸¾2ä¸ªä¾‹å­</p>
<ul>
<li>express  <a href="https://travis-ci.org/strongloop/express">https://travis-ci.org/strongloop/express</a></li>
<li>koa      <a href="https://travis-ci.org/koajs/koa">https://travis-ci.org/koajs/koa</a></li>
</ul>
<h2>æµ‹è¯•æŠ¥å‘Š</h2>
<p>è¿‘å¹´éšç€tdd/bddï¼Œå¼€æºé¡¹ç›®ï¼Œå’Œæ•æ·å¼€å‘çš„ç«çƒ­ï¼Œç¨‹åºå‘˜ä»¬ä¸å†æ»¡è¶³è¯´ï¼Œæˆ‘è´¡çŒ®äº†ä¸€ä¸ªå¼€æºé¡¹ç›®</p>
<p>è¦æœ‰é«˜è¦æ±‚ï¼Œæˆ‘è¦åŠ æµ‹è¯•</p>
<p>è¦æœ‰æ›´é«˜è¦æ±‚ï¼Œæˆ‘è¦æŠŠæ¯ä¸€ä¸ªå‡½æ•°éƒ½æµ‹è¯•åˆ°ï¼Œè®©åˆ«äººç›¸ä¿¡æˆ‘çš„ä»£ç æ²¡æœ‰ä»»ä½•é—®é¢˜</p>
<p>ä¸Šä¸€å°èŠ‚è®²çš„ciï¼Œå®é™…ä¸Šè§£å†³äº†åå¤æµ‹è¯•çš„è‡ªåŠ¨åŒ–é—®é¢˜ã€‚ä½†æ˜¯å¦‚ä½•çœ‹æˆ‘çš„ç¨‹åºé‡Œçš„æ¯ä¸€ä¸ªå‡½æ•°éƒ½æµ‹è¯•äº†å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯æµ‹è¯•è¦†ç›–ç‡</p>
<p>åœ¨nodejsé‡Œï¼Œæ¨è<a href="https://github.com/gotwarlost/istanbul">istanbul</a></p>
<p>Istanbul - å®˜æ–¹ä»‹ç» a JS code coverage tool written in JS</p>
<p>å®ƒå¯ä»¥é€šè¿‡3ç§é€”å¾„ç”Ÿæˆè¦†ç›–æŠ¥å‘Š</p>
<ul>
<li>cli</li>
<li>ä»£ç </li>
<li>gulpæ’ä»¶</li>
</ul>
<p>å®‰è£…</p>
<pre class="prettyprint"><code>$ npm install -g istanbul
</code></pre><p>æ‰§è¡Œ</p>
<pre class="prettyprint"><code>$ istanbul cover my-test-script.js -- my test args
</code></pre><p>å®ƒä¼šç”Ÿæˆ<code>./coverage</code>ç›®å½•ï¼Œè¿™é‡Œé¢å°±æ˜¯æµ‹è¯•æŠ¥å‘Š</p>
<p>æ¯”å¦‚æˆ‘çš„é¡¹ç›®é‡Œ</p>
<pre class="prettyprint"><code>./node_modules/.bin/istanbul cover ./node_modules/mocha/bin/_mocha --report lcovonly
    #MongooseDao()
      âœ“ should return ok when record create
      âœ“ should return ok when record delete fixture-user
      âœ“ should return ok when record deleteById
      âœ“ should return ok when record removeById
      âœ“ should return ok when record getById
      âœ“ should return ok when record getAll
      âœ“ should return ok when record all
      âœ“ should return ok when record query


  8 passing (50ms)

=============================================================================
Writing coverage object [/Users/sang/workspace/moa/mongoosedao/coverage/coverage.json]
Writing coverage reports at [/Users/sang/workspace/moa/mongoosedao/coverage]
=============================================================================

=============================== Coverage summary ===============================
Statements   : 47.27% ( 26/55 )
Branches     : 8.33% ( 1/12 )
Functions    : 60% ( 9/15 )
Lines        : 47.27% ( 26/55 )
================================================================================
</code></pre><p>é»˜è®¤ï¼Œå®ƒä¼šç”Ÿæˆcoverage.jsonå’ŒIcov.infoï¼Œå¦‚æœä½ æƒ³ç”Ÿæˆhtmlä¹Ÿå¯ä»¥çš„ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œä¸Šé¢çš„ç»“æœ47.27%æ˜¯æˆ‘æµ‹è¯•è¦†ç›–çš„å æ¯”ï¼Œå³55ä¸ªå‡½æ•°ï¼Œæˆ‘çš„æµ‹è¯•é‡Œåªè¦†ç›–äº†26ä¸ªã€‚</p>
<p>é‚£ä¹ˆæˆ‘éœ€è¦æœ‰åœ°æ–¹èƒ½å¤Ÿå±•ç¤ºå‡ºæ¥å•Š</p>
<h2>å®è·µ</h2>
<p>æˆ‘ä»¬ä»¥<a href="https://github.com/moajs/mongoosedao">mongoosedao</a>é¡¹ç›®ä¸ºä¾‹ï¼Œä»‹ç»ä¸€ä¸‹å¦‚ä½•é›†æˆæµ‹è¯•ï¼Œciå’Œæµ‹è¯•è¦†ç›–ç‡</p>
<p>æœ€ç»ˆæ•ˆæœå¦‚å›¾
<img src="//dn-cnode.qbox.me/FvD-MxdYvJYzCxQAGXX-udUb_VKX" alt="5.png"></p>
<h3>npm run</h3>
<p>package.jsoné‡Œå®šä¹‰è‡ªå®šä¹‰æ‰§è¡Œè„šæœ¬</p>
<pre class="prettyprint"><code>&quot;scripts&quot;: {
  &quot;start&quot;: &quot;npm publish .&quot;,
  &quot;test&quot;: &quot;./node_modules/.bin/gulp&quot;,
  &quot;mocha&quot;: &quot;./node_modules/.bin/mocha -u bdd&quot;,
  &quot;cov&quot;:&quot;./node_modules/.bin/istanbul cover ./node_modules/mocha/bin/_mocha --report lcovonly -- -R spec &amp;&amp; cat ./coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js &amp;&amp; rm -rf ./coverage&quot;
},
</code></pre><p>é™¤äº†startå’Œtestå¤–ï¼Œéƒ½æ˜¯è‡ªå®šä¹‰ä»»åŠ¡ï¼Œå…¶ä»–éƒ½è¦åŠ runå‘½ä»¤</p>
<pre class="prettyprint"><code>npm run mocha
npm run cov
</code></pre><p>æ›´å¤šè§<a href="https://cnodejs.org/topic/54646c7f88b869cc33a97924">npm-run-testæ•™ç¨‹</a></p>
<h3>gulp watch</h3>
<pre class="prettyprint"><code>var gulp = require(&#x27;gulp&#x27;);
var watch = require(&#x27;gulp-watch&#x27;);

var path = &#x27;test/**/*.js&#x27;;

gulp.task(&#x27;watch&#x27;, function() {
  gulp.watch([&#x27;test/**/*.js&#x27;, &#x27;lib/*.js&#x27;], [&#x27;mocha&#x27;]);
});

var mocha = require(&#x27;gulp-mocha&#x27;);

gulp.task(&#x27;mocha&#x27;, function () {
    return gulp.src(path , {read: false})
        // gulp-mocha needs filepaths so you can&#x27;t have any plugins before it 
        .pipe(mocha({reporter: &#x27;spec&#x27;}));
});


gulp.task(&#x27;default&#x27;,[&#x27;mocha&#x27;, &#x27;watch&#x27;]);
</code></pre><p>è¿™æ ·å°±å¯ä»¥æ‰§è¡Œgulpçš„æ—¶å€™ï¼Œå½“æ–‡ä»¶å˜åŠ¨ï¼Œä¼šè‡ªåŠ¨è§¦å‘mochaæµ‹è¯•ï¼Œç®€åŒ–æ¯æ¬¡éƒ½è¾“å…¥npm testè¿™æ ·çš„æ“ä½œã€‚</p>
<p>å½“ç„¶ä½ å¯ä»¥ç©æ›´å¤šçš„gulpï¼Œå¦‚æœä¸ç†Ÿæ‚‰ï¼Œå‚è€ƒ</p>
<ul>
<li><a href="https://cnodejs.org/topic/5508f03d3135610a365b013d">ä»‹ç»gulpçš„ä¸€å¼ ä¸é”™çš„å›¾</a></li>
<li><a href="https://github.com/streakq/js-tools-best-practice/blob/master/doc/Gulp.md">gulpå®è·µ</a></li>
</ul>
<h3>åˆ›å»º<code>.travis.yml</code></h3>
<p>é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œå’Œpackage.jsonå¹³çº§</p>
<pre class="prettyprint"><code>language: node_js
repo_token: COVERALLS.IO_TOKEN
services: mongodb
node_js:
  - &quot;0.12&quot;
  - &quot;0.11&quot;
  - &quot;0.10&quot;
script: npm run mocha
after_script:
  npm run cov
</code></pre><p>è¯´æ˜</p>
<ul>
<li>å¦‚æœä¾èµ–mongoç­‰æ•°æ®åº“ï¼Œä¸€å®šè¦å†™services</li>
<li>æŠŠæµ‹è¯•è¦†ç›–ç‡æ”¾åˆ°æ‰§è¡Œæµ‹è¯•ä¹‹åï¼Œé¿å…æŠ¥402é”™è¯¯</li>
</ul>
<p>åœ¨travis-ci.orgä¸Šï¼Œgithubæˆæƒï¼Œæ·»åŠ repoéƒ½æ¯”è¾ƒç®€å•</p>
<p>æ·»åŠ ä¹‹åï¼Œå°±å¯ä»¥çœ‹åˆ°ï¼Œæ¯”å¦‚</p>
<p><a href="https://travis-ci.org/moajs/mongoosedao">https://travis-ci.org/moajs/mongoosedao</a></p>
<p>travis-ciå®é™…ä¸Šæ ¹æ®githubçš„ä»£ç å˜åŠ¨è¿›è¡Œè‡ªåŠ¨æŒç»­æ„å»º,ä½†æ˜¯æœ‰çš„æ—¶å€™å®ƒä¸ä¸€å®šæ›´æ–°ï¼Œæˆ–è€…è¯´ï¼Œä½ éœ€è¦æ‰‹åŠ¨é€‰ä¸€ä¸‹ï¼š</p>
<p><img src="//dn-cnode.qbox.me/Fpvl9NVDe4SjTUQwy0p8lj6S5zBC" alt="1.png"></p>
<p>ç‚¹å‡»<code># 10 passed</code>,è¿™æ ·å°±å¯ä»¥å¼ºåˆ¶å®ƒæ‰‹åŠ¨é›†æˆäº†ã€‚</p>
<p>å…¶ä»–éƒ½å¾ˆç®€å•ï¼Œæ³¨æ„æ›¿æ¢COVERALLS.IO_TOKENå³å¯ã€‚</p>
<h3>åˆ›å»º <code>.coveralls.yml</code></h3>
<p><a href="https://coveralls.io/">https://coveralls.io/</a>æ˜¯ä¸€ä¸ªä»£ç æµ‹è¯•è¦†ç›–ç‡çš„ç½‘ç«™ï¼Œ</p>
<p>nodejsä¸‹é¢çš„ä»£ç æµ‹è¯•è¦†ç›–ç‡ï¼ŒåŸç†æ˜¯é€šè¿‡<a href="https://github.com/gotwarlost/istanbul">istanbul</a>ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œä¸Šä¼ åˆ°coverallsç½‘ç«™ä¸Šï¼Œç„¶åä»¥badgeçš„å½¢å¼å±•ç¤ºå‡ºæ¥</p>
<p>æ¯”å¦‚</p>
<p><a href="https://coveralls.io/r/moajs/mongoosedao"><img src="https://coveralls.io/repos/moajs/mongoosedao/badge.png" alt="Coverage Status"></a></p>
<p>å…·ä½“å®è·µå’Œtravis-ciç±»ä¼¼ï¼Œç”¨githubè´¦å·ç™»é™†ï¼Œç„¶åæ·»åŠ repoï¼Œç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œå’Œpackage.jsonå¹³çº§ï¼Œå¢åŠ <code>.coveralls.yml</code></p>
<pre class="prettyprint"><code>service_name: travis-pro
repo_token: 99UNur6O7ksBqiwgg1NG1sSFhmu78A0t7
</code></pre><p>åœ¨ä¸Šï¼Œç¬¬ä¸€æ¬¡æ·»åŠ repoï¼Œæ˜¾ç¤ºçš„æ˜¯â€œSET UP COVERALLSâ€ï¼Œé‡Œé¢æœ‰tokenï¼Œéœ€è¦æ”¾åˆ°<code>.coveralls.yml</code>é‡Œï¼Œ</p>
<p><img src="//dn-cnode.qbox.me/FiVMpMwSpnKU9ogQ5gYNW9wKI1Xw" alt="2.png"></p>
<p>å¦‚æœæˆåŠŸæäº¤äº†ï¼Œå°±å¯ä»¥çœ‹åˆ°æ•°æ®äº†</p>
<p><img src="//dn-cnode.qbox.me/FmiaA3qsh6ThyvIS2mFUL2d17rzY" alt="3.png"></p>
<h3>åœ¨readme.mdé‡Œå¢åŠ badge</h3>
<pre class="prettyprint"><code>[![Build Status](https://travis-ci.org/moajs/mongoosedao.png?branch=master)](https://travis-ci.org/moajs/mongoosedao)
[![Coverage Status](https://coveralls.io/repos/moajs/mongoosedao/badge.png)](https://coveralls.io/r/moajs/mongoosedao)
</code></pre><p>å®ƒå°±ä¼šæ˜¾ç¤ºå¦‚ä¸‹</p>
<p><a href="https://travis-ci.org/moajs/mongoosedao"><img src="https://travis-ci.org/moajs/mongoosedao.png?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/r/moajs/mongoosedao"><img src="https://coveralls.io/repos/moajs/mongoosedao/badge.png" alt="Coverage Status"></a></p>
<h2>å¦å¤–ä¸€ç§ç”¨Makefileçš„ç©æ³•å®è·µ</h2>
<p>ä¸¾ä¾‹ï¼š<a href="https://github.com/node-webot/wechat-api/blob/master/Makefile">https://github.com/node-webot/wechat-api/blob/master/Makefile</a></p>
<pre class="prettyprint"><code>TESTS = test/*.js
REPORTER = spec
TIMEOUT = 20000
ISTANBUL = ./node_modules/.bin/istanbul
MOCHA = ./node_modules/mocha/bin/_mocha
COVERALLS = ./node_modules/coveralls/bin/coveralls.js

test:
    @NODE_ENV=test $(MOCHA) -R $(REPORTER) -t $(TIMEOUT) \
        $(MOCHA_OPTS) \
        $(TESTS)

test-cov:
    @$(ISTANBUL) cover --report html $(MOCHA) -- -t $(TIMEOUT) -R spec $(TESTS)

test-coveralls:
    @$(ISTANBUL) cover --report lcovonly $(MOCHA) -- -t $(TIMEOUT) -R spec $(TESTS)
    @echo TRAVIS_JOB_ID $(TRAVIS_JOB_ID)
    @cat ./coverage/lcov.info | $(COVERALLS) &amp;&amp; rm -rf ./coverage

test-all: test test-coveralls

.PHONY: test
</code></pre><p>æˆ‘ä¸ªäººæ›´å–œæ¬¢npm+gulpçš„å†™æ³•ï¼Œæ€»æ˜¯æœ‰ä¸€ç§makeæ˜¯cé‡Œå¤è€çš„ä¸œä¸œã€‚ã€‚ã€‚</p>
<h2>æ€»ç»“</h2>
<p>æœ¬æ–‡è®²äº†</p>
<ul>
<li>nodejsé‡Œå¸¸ç”¨æ¡†æ¶
<ul>
<li>mocha</li>
<li>tape</li>
<li>tap</li>
<li>å‰æ²¿æŠ€æœ¯ï¼šcucumberå’Œvowsjs</li>
</ul>
</li>
<li>ç§‘æ™®ä¸€ä¸‹CI</li>
<li>æµ‹è¯•æŠ¥å‘Š
<ul>
<li>istanbul</li>
</ul>
</li>
<li>å®è·µ
<ul>
<li>gulp + npm run</li>
<li>mocha</li>
<li>travis-ci</li>
<li>coveralls</li>
</ul>
</li>
<li>ä»‹ç»äº†åŸºäºmakefileçš„å¦ä¸€ç§ç©æ³•</li>
</ul>
<p>å…¨æ–‡å®Œ</p>
<p>æ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€nodeå…¨æ ˆã€‘</p>
<p><img src="//dn-cnode.qbox.me/FtALxsauUkYDGdzcuA5y6BaIdUMC" alt="nodeå…¨æ ˆ.png"></p>
</div>
      </div>
    </div>
  </div>
  
  <div class='panel'>
    <div class='header'>
      <span class='col_fade'>1 å›å¤</span>
    </div>
    <div class='cell reply_area reply_item
  '
  id="reply1" reply_id="558e101cebf9c92d17e73385" reply_to_id="">
  <a class="anchor" id="558e101cebf9c92d17e73385"></a>

  <div class='author_content'>
    <a href="/user/SoaringTiger" class="user_avatar">
      <img src="/agent?url=https%3A%2F%2Favatars.githubusercontent.com%2Fu%2F10105704%3Fv%3D3%26s%3D120" title="SoaringTiger"/></a>

    <div class='user_info'>
      <a class='dark reply_author' href="/user/SoaringTiger">SoaringTiger
      </a>
      <a class="reply_time" href="#558e101cebf9c92d17e73385">1æ¥¼â€¢1ä¸ªæœˆå‰</a>
    </div>
    <div class='user_action'>
      <span>
        <i class="fa up_btn
          fa-thumbs-o-up
          invisible" title="å–œæ¬¢"></i>
        <span class="up-count">
          
        </span>
      </span>
      
      <span>
        
      </span>
    </div>
  </div>
  <div class='reply_content from-SoaringTiger'>
    <div class="markdown-text"><p>å¥½å¹²è´§ï¼ŒğŸ‘</p>
</div>
  </div>
  <div class='clearfix'>
    <div class='reply2_area'>
      
    </div>
  </div>
</div>

  </div>
  
  
</div>

<div class="replies_history">
  <div class="inner_content"></div>
  <div class="anchor"></div>
</div>




<script type="text/javascript">
  (function(){
    var timer = null; //å¯¹è¯æ¡†å»¶æ—¶å®šæ—¶å™¨
    // åˆå§‹åŒ– $('.replies_history')
    var $repliesHistory = $('.replies_history');
    var $repliesHistoryContent = $repliesHistory.find('.inner_content');
    $repliesHistory.hide();
    // END
    // é¼ æ ‡ç§»å…¥å¯¹è¯æ¡†æ¸…é™¤éšè—å®šæ—¶å™¨ï¼›ç§»å‡ºæ—¶éšè—å¯¹è¯æ¡†
    $repliesHistory.on('mouseenter', function(){
      clearTimeout(timer);
    }).on('mouseleave', function(){
      $repliesHistory.fadeOut('fast');
    });
    // æ˜¾ç¤ºè¢« at ç”¨æˆ·çš„æœ¬é¡µè¯„è®º
    if ($('.reply2_item').length === 0) {
      // åªåœ¨æµå¼è¯„è®ºå¸ƒå±€ä¸­ä½¿ç”¨

      $('#content').on('mouseenter', '.reply_content a', function (e) {
        clearTimeout(timer);
        var $this = $(this);
        if ($this.text()[0] === '@') {
          var thisText = $this.text().trim();
          var loginname = thisText.slice(1);
          var offset = $this.offset();
          var width = $this.width();
          var mainOffset = $('#main').offset();
          $repliesHistory.css('left', offset.left-mainOffset.left+width+10); // magic number
          $repliesHistory.css('top', offset.top-mainOffset.top-10); // magic number
          $repliesHistory.css({
            'z-index': 1,
          });
          $repliesHistoryContent.empty();
          var chats = [];
          var replyToId = $this.closest('.reply_item').attr('reply_to_id');
          while (replyToId) {
            var $replyItem = $('.reply_item[reply_id=' + replyToId + ']');
            var replyContent = $replyItem.find('.reply_content').text().trim();
            if (replyContent.length > 0) {
              chats.push([
                $($replyItem.find('.user_avatar').html()).attr({
                  height: '30px',
                  width: '30px',
                }), // avatar
                (replyContent.length>300?replyContent.substr(0,300)+'...':replyContent), // reply content
                '<a href="#'+replyToId+'" class="scroll_to_original" title="æŸ¥çœ‹åŸæ–‡">â†‘</a>'
              ]);
            }
            replyToId = $replyItem.attr('reply_to_id');
          }
          if(chats.length > 0) {
            chats.reverse();

            $repliesHistoryContent.append('<div class="title">æŸ¥çœ‹å¯¹è¯</div>');
            chats.forEach(function (pair, idx) {
              var $chat = $repliesHistoryContent.append('<div class="item"></div>');
              $chat.append(pair[0]); // å¤´åƒ
              $chat.append($('<span>').text(pair[1])); // å†…å®¹
              $chat.append(pair[2]); // æŸ¥çœ‹åŸæ–‡ anchor
            });
            $repliesHistory.fadeIn('fast');
          }else{
            $repliesHistory.hide();
          }
        }
      }).on('mouseleave', '.reply_content a', function (e) {
        timer = setTimeout(function(){
          $repliesHistory.fadeOut('fast');
        }, 500);
      });
    }
    // END æ˜¾ç¤ºè¢« at ç”¨æˆ·çš„æœ¬é¡µè¯„è®º
  })();

  // ç‚¹èµ
  $('.up_btn').click(function (e) {
    var $this = $(this);
    var replyId = $this.closest('.reply_area').attr('reply_id');
    $.ajax({
      url: '/reply/' + replyId + '/up',
      method: 'POST',
    }).done(function (data) {
      if (data.success) {
        $this.removeClass('invisible');
        var currentCount = Number($this.next('.up-count').text().trim()) || 0;
        if (data.action === 'up') {
          $this.next('.up-count').text(currentCount + 1);
          $this.addClass('uped');
        } else {
          if (data.action === 'down') {
            $this.next('.up-count').text(currentCount - 1);
            $this.removeClass('uped');
          }
        }
      } else {
        alert(data.message);
      }
    }).fail(function (xhr) {
      if (xhr.status === 403) {
        alert('è¯·å…ˆç™»å½•ï¼Œç™»é™†åå³å¯ç‚¹èµã€‚');
      }
    });
  });
  // END ç‚¹èµ
</script>

</div>
<div id='backtotop'>å›åˆ°é¡¶éƒ¨</div>
<div id='footer'>
  <div id='footer_main'>
    <div class="links">
      <a class='dark' href='/rss'>RSS</a>
      |
      <a class='dark' href='https://github.com/cnodejs/nodeclub/'>æºç åœ°å€</a>
    </div>

    <div class='col_fade'>
  <p>æœåŠ¡å™¨æ­å»ºåœ¨
    <a href="https://www.digitalocean.com/?refcode=eba02656eeb3" target="_blank"
      class="sponsor_outlink" data-label="digitalocean">
      <img src="//dn-cnodestatic.qbox.me/public/images/digitalocean.png" title="digitalocean"
      alt="digitalocean" width="92px"/>
    </a>
  ï¼Œå­˜å‚¨èµåŠ©å•†ä¸º
    <a href="http://www.qiniu.com/?ref=cnode" target="_blank"
      class="sponsor_outlink" data-label="qiniu_bottom">
      <img src="//dn-cnodestatic.qbox.me/public/images/qiniu.png" title="ä¸ƒç‰›äº‘å­˜å‚¨"
      alt="ä¸ƒç‰›äº‘å­˜å‚¨" width="115px"/>
    </a>
  </p>
</div>


  </div>
</div>
<div id="sidebar-mask"></div>


<script>
  // google analytics
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script',"/agent?&url=https%3A%2F%2Fwww.google-analytics.com%2Fanalytics.js",'ga');

  ga('create', 'UA-41753901-5', 'auto');
  ga('send', 'pageview');
</script>



<div style="display:none;">
  <script src="//s95.cnzz.com/z_stat.php?id=1254020586&web_id=1254020586" language="JavaScript"></script>
</div>


</body>
</html>
